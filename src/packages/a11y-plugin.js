import{nextTick as t}from"swup";import e from"@swup/plugin";import i from"on-demand-live-region";import"focus-options-polyfill";class n extends e{constructor(t){void 0===t&&(t={}),super(),this.name="SwupA11yPlugin",this.requires={swup:">=4"},this.defaults={contentSelector:"main",headingSelector:"h1, h2, [role=heading]",announcementTemplate:"Navigated to: {title}",urlTemplate:"New page at {url}",respectReducedMotion:!1},this.options=void 0,this.liveRegion=void 0,this.options={...this.defaults,...t},this.liveRegion=new i}mount(){this.swup.hooks.create("content:focus"),this.on("visit:start",this.markAsBusy),this.on("visit:end",this.unmarkAsBusy),this.on("visit:start",this.prepareVisit),this.on("content:replace",this.handleNewPageContent),this.options.respectReducedMotion&&(this.before("visit:start",this.disableTransitionAnimations),this.before("visit:start",this.disableScrollAnimations),this.before("link:self",this.disableScrollAnimations),this.before("link:anchor",this.disableScrollAnimations))}markAsBusy(){document.documentElement.setAttribute("aria-busy","true")}unmarkAsBusy(){document.documentElement.removeAttribute("aria-busy")}prepareVisit(t){t.focus=this.options.contentSelector}handleNewPageContent(){try{const e=this;return Promise.resolve(t()).then(function(){return e.announcePageName(),Promise.resolve(e.focusPageContent()).then(function(){})})}catch(t){return Promise.reject(t)}}announcePageName(){const{contentSelector:t,headingSelector:e,urlTemplate:i,announcementTemplate:n}=this.options;let o=i.replace("{url}",window.location.pathname);document.title&&(o=document.title);const s=document.querySelector(t);if(s){const t=s.querySelectorAll(e);if(t&&t.length){const[e]=t;o=e.getAttribute("aria-label")||e.textContent||o}}const r=n.replace("{title}",o.trim());this.liveRegion.say(r)}focusPageContent(){try{return Promise.resolve(this.swup.hooks.call("content:focus",void 0,t=>{if(!t.focus)return;const e=document.querySelector(t.focus);e&&(e.setAttribute("tabindex","-1"),e.focus({preventScroll:!0}))})).then(function(){})}catch(t){return Promise.reject(t)}}disableTransitionAnimations(t){t.animation.animate=this.shouldAnimate()}disableScrollAnimations(t){t.scroll.animate=this.shouldAnimate()}shouldAnimate(){return!window.matchMedia("(prefers-reduced-motion: reduce)").matches}}export{n as default};
//# sourceMappingURL=index.module.js.map
