import e from"@swup/plugin";function t(e){return"title"!==e.localName&&!e.matches("[data-swup-theme]")}function s(e,t){return e.outerHTML===t.outerHTML}function n(e){return e.matches("link[rel=stylesheet][href]")}class o extends e{constructor(e={}){super();const o=this;this.name="SwupHeadPlugin",this.requires={swup:">=4.6"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,timeout:3e3},this.options=void 0,this.updateHead=function(e,{page:{}}){try{const u=e.to.document,{removed:l,added:a}=function(e,n,{shouldPersist:o=(()=>!1)}={}){const r=Array.from(e.children),i=Array.from(n.children),u=(l=r,i.reduce((e,t,n)=>(l.some(e=>s(t,e))||e.push({el:t,index:n}),e),[]));var l;const a=function(e,t){return e.reduce((e,n)=>(t.some(e=>s(n,e))||e.push({el:n}),e),[])}(r,i);return a.reverse().filter(({el:e})=>t(e)).filter(({el:e})=>!o(e)).forEach(({el:t})=>e.removeChild(t)),u.filter(({el:e})=>t(e)).forEach(({el:t,index:s=0})=>{e.insertBefore(t.cloneNode(!0),e.children[s+1]||null)}),{removed:a.map(({el:e})=>e),added:u.map(({el:e})=>e)}}(document.head,u.head,{shouldPersist:e=>o.isPersistentTag(e)});o.swup.log(`Removed ${l.length} / added ${a.length} tags in head`);const c=(r=document.documentElement).lang!==(i=u.documentElement).lang?(r.lang=i.lang,r.lang):null;c&&o.swup.log(`Updated lang attribute: ${c}`);const d=function(){if(o.options.awaitAssets){const e=function(e,t=0){return e.filter(n).map(e=>function(e,t=0){const s=t=>{(({href:e})=>Array.from(document.styleSheets).map(({href:e})=>e).includes(e))(e)?t():setTimeout(()=>s(t),10)};return new Promise(e=>{s(e),t>0&&setTimeout(e,t)})}(e,t))}(a,o.options.timeout),t=function(){if(e.length)return o.swup.log(`Waiting for ${e.length} assets to load`),Promise.resolve(Promise.all(e)).then(function(){})}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(d&&d.then?d.then(function(){}):void 0)}catch(e){return Promise.reject(e)}var r,i},this.options={...this.defaults,...e},this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(e){const{persistTags:t}=this.options;return"function"==typeof t?t(e):"string"==typeof t?e.matches(t):Boolean(t)}}export{o as default};
//# sourceMappingURL=index.module.js.map
